<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>KawachYatri - Trip in Progress</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      --bg: #020617;
      --bg-grad-1: #0f172a;
      --bg-grad-2: #020617;
      --card-bg: #020617;
      --accent: #22c55e;
      --accent-soft: rgba(34, 197, 94, 0.18);
      --danger: #ef4444;
      --text-main: #e5e7eb;
      --text-soft: #9ca3af;
      --border-soft: #1f2937;
      --shadow-soft: 0 18px 40px rgba(15, 23, 42, 0.7);
      --radius-xl: 24px;
      --radius-full: 999px;
      --logo-color: #022c22;
      --logo-bg-start: #bbf7d0;
      --logo-bg-end: #16a34a;
      --input-bg: #020617;
    }

    html[data-theme="light"] .app-shell {
      --bg: #f8fafc;
      --bg-grad-1: #f1f5f9;
      --bg-grad-2: #e2e8f0;
      --card-bg: #ffffff;
      --accent: #16a34a;
      --accent-soft: rgba(22, 163, 74, 0.12);
      --danger: #dc2626;
      --text-main: #0f172a;
      --text-soft: #475569;
      --border-soft: #cbd5e1;
      --input-bg: #ffffff;
      --shadow-soft: 0 14px 26px rgba(0, 0, 0, 0.12);
      --logo-color: #f0fdf4;
      --logo-bg-start: #16a34a;
      --logo-bg-end: #15803d;
      background: #ffffff;
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: stretch;
      background: radial-gradient(circle at top, var(--bg-grad-1), var(--bg-grad-2) 60%);
      color: var(--text-main);
    }

    .app-shell {
      width: 100%;
      max-width: 430px;
      min-height: 100vh;
      padding: 16px 14px 20px;
      display: flex;
      flex-direction: column;
    }

    @media (min-width: 480px) {
      .app-shell {
        margin: 16px 0;
        border-radius: 32px;
        border: 1px solid #111827;
        box-shadow: var(--shadow-soft);
        background: radial-gradient(circle at top, #020617, #020617 65%);
      }
    }

    /* Status bar */
    .status-strip {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      color: var(--text-soft);
      padding-bottom: 10px;
      opacity: 0.9;
    }

    .status-strip span:nth-child(2) {
      letter-spacing: 0.1em;
      font-weight: 600;
      color: #e5e7eb;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    /* Header */
    .app-header {
      border-radius: 24px;
      padding: 14px 16px;
      background: var(--card-bg);
      border: 1px solid var(--border-soft);
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
      position: relative;
      overflow: hidden;
    }

    [data-theme="light"] .app-header {
      background: var(--card-bg);
      border: 1px solid var(--border-soft);
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-dot {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 25%, #bbf7d0, #16a34a 70%);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 700;
      color: #022c22;
      box-shadow: 0 0 0 1px rgba(16, 185, 129, 0.7);
    }

    .app-title-block {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .app-name {
      font-size: 14px;
      font-weight: 600;
      letter-spacing: 0.03em;
    }

    .app-subtitle {
      font-size: 11px;
      color: var(--text-soft);
    }

    .header-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
    }

    .user-id-pill {
      font-size: 10px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(148, 163, 184, 0.6);
      max-width: 180px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .trip-status-pill {
      font-size: 10px;
      padding: 3px 7px;
      border-radius: 999px;
      background: rgba(34, 197, 94, 0.12);
      border: 1px solid rgba(34, 197, 94, 0.6);
      display: inline-flex;
      align-items: center;
      gap: 5px;
      color: #bbf7d0;
    }

    .theme-toggle {
      background: var(--card-bg);
      border: 1px solid var(--border-soft);
      border-radius: 999px;
      padding: 8px 14px;
      cursor: pointer;
      font-size: 13px;
      color: var(--text-main);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s ease;
      box-shadow: var(--shadow-soft);
    }

    .theme-toggle:hover {
      background: var(--accent-soft);
      border-color: var(--accent);
      transform: scale(1.05);
    }

    .status-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 12px rgba(34, 197, 94, 0.8);
    }

    /* Card */
    .card {
      background: radial-gradient(circle at top, var(--card-bg), var(--card-bg) 70%);
      border-radius: var(--radius-xl);
      border: 1px solid var(--border-soft);
      padding: 18px 16px 16px;
      box-shadow: var(--shadow-soft);
      margin-bottom: 14px;
    }

    .card-header-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 8px;
    }

    .card-header-row h2 {
      margin: 0;
      font-size: 15px;
    }

    .card-header-row .subtitle {
      display: block;
      font-size: 11px;
      color: var(--text-soft);
      margin-top: 2px;
    }

    .pill-label {
      font-size: 10px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid #374151;
      background: #020617;
      color: var(--text-soft);
    }

    .muted {
      font-size: 11px;
      color: var(--text-soft);
      margin-top: 6px;
      line-height: 1.5;
      text-align: center;
    }

    /* SOS Layout */
    .sos-layout {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 10px;
    }

    .sos-circle {
      width: 190px;
      height: 190px;
      border-radius: 999px;
      margin: 6px auto 10px;
      background: radial-gradient(circle at 30% 0, #fee2e2, #b91c1c 60%);
      box-shadow: 0 0 40px rgba(248, 113, 113, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }

    .sos-circle-inner {
      width: 130px;
      height: 130px;
      border-radius: inherit;
      border: 2px dashed rgba(254, 226, 226, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 30px;
      letter-spacing: 0.2em;
      color: #fef2f2;
      text-indent: 0.18em;
    }

    .sos-pulse {
      position: absolute;
      inset: 14px;
      border-radius: inherit;
      border: 1px solid rgba(254, 202, 202, 0.6);
      opacity: 0.9;
      animation: pulse 1.6s infinite ease-out;
    }

    @keyframes pulse {
      0% {
        transform: scale(0.95);
        opacity: 0.85;
      }
      100% {
        transform: scale(1.1);
        opacity: 0;
      }
    }

    .sos-caption {
      font-size: 11px;
      color: var(--text-soft);
      text-align: center;
      margin-top: 0;
      line-height: 1.5;
    }

    .sos-caption strong {
      color: #fecaca;
      font-weight: 600;
    }

    /* Mini trip details */
    .trip-mini-card {
      border-radius: 18px;
      border: 1px solid var(--border-soft);
      background: radial-gradient(circle at top left, var(--accent-soft), transparent 65%);
      padding: 9px 10px;
      font-size: 11px;
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .trip-mini-row {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      align-items: center;
    }

    .trip-mini-label {
      color: var(--text-soft);
    }

    .trip-mini-value {
      font-weight: 600;
    }

    .trip-status-live {
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 10px;
      background: rgba(34, 197, 94, 0.14);
      border: 1px solid rgba(34, 197, 94, 0.6);
      color: var(--text-main);
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }

    .live-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 12px rgba(34, 197, 94, 0.8);
    }

    /* Buttons */
    .btn {
      border-radius: var(--radius-full);
      border: none;
      padding: 11px 14px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      width: 100%;
      transition: transform 0.08s ease, box-shadow 0.12s ease,
        background 0.12s ease, opacity 0.12s ease;
    }

    .btn-danger {
      background: radial-gradient(circle at 15% 0, #fecaca, #dc2626 70%);
      color: #fef2f2;
      box-shadow: 0 18px 36px rgba(239, 68, 68, 0.7);
      margin-top: 6px;
    }

    .btn-soft {
      background: var(--accent-soft);
      border: 1px solid rgba(34, 197, 94, 0.5);
      color: #bbf7d0;
      margin-top: 6px;
    }

    [data-theme="light"] .btn-soft {
      background: rgba(22, 163, 74, 0.12);
      border-color: rgba(22, 163, 74, 0.35);
      color: #0f172a; /* darker text for readability on light background */
    }

    .btn-ghost {
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(30, 64, 175, 0.7);
      color: #e5e7eb;
      margin-top: 4px;
    }

    .btn:active {
      transform: translateY(1px) scale(0.99);
      box-shadow: none;
    }

    .btn-row {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 12px;
    }

    /* Footer */
    .footer {
      margin-top: auto;
      font-size: 10px;
      color: var(--text-soft);
      display: flex;
      justify-content: space-between;
      gap: 8px;
      padding: 6px 2px 0;
      opacity: 0.85;
    }

    .footer span {
      max-width: 60%;
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <!-- Fake status bar -->
    <div class="status-strip">
      <span>12:20</span>
      <span>KAWACH YATRI</span>
      <span>üì∂ 4G üîã</span>
    </div>

    <!-- Header -->
    <header class="app-header">
      <div class="header-left">
        <div class="logo-dot">KY</div>
        <div class="app-title-block">
          <div class="app-name">KawachYatri</div>
          <div class="app-subtitle">Trip in Progress ¬∑ Live Monitoring</div>
        </div>
      </div>
      <div class="header-right">
        <div class="user-id-pill">ID: STSM-USER-001</div>
        <div class="trip-status-pill">
          <span class="status-dot"></span>
          Trip active ¬∑ Geo-fence ON
        </div>
        <button class="theme-toggle" onclick="toggleTheme()" title="Toggle theme">
          <span id="theme-icon">üåô</span>
          <span id="theme-text">Dark</span>
        </button>
      </div>
    </header>

    <!-- MAIN -->
    <main>
      <div class="card">
        <div class="card-header-row">
          <div>
            <h2>Trip in progress</h2>
            <span class="subtitle">AI safety monitoring is active</span>
          </div>
          <span class="pill-label">LIVE</span>
        </div>

        <div class="sos-layout">
          <!-- SOS button -->
          <div class="sos-circle">
            <div class="sos-pulse"></div>
            <div class="sos-circle-inner">
              SOS
            </div>
          </div>

          <p class="sos-caption">
            Press <strong>SOS</strong> only during real emergency.<br />
            In live deployment, your <strong>current location, trip details & profile</strong>
            will be sent to police control room and your guardian.
          </p>

          <!-- Mini trip summary (populated from localStorage.activeTrip) -->
          <div class="trip-mini-card" id="trip-mini-card">
            <div class="trip-mini-row">
              <span class="trip-mini-label">From ‚Üí To</span>
              <span class="trip-mini-value" id="trip-from-to">‚Äî</span>
            </div>
            <div class="trip-mini-row">
              <span class="trip-mini-label">Safe zone radius</span>
              <span class="trip-mini-value" id="trip-radius">‚Äî</span>
            </div>
            <div class="trip-mini-row">
              <span class="trip-mini-label">Status</span>
              <span class="trip-status-live" id="trip-status">
                <span class="live-dot"></span>
                Initializing‚Ä¶
              </span>
            </div>
            <div class="trip-mini-row" style="margin-top:6px; font-size:12px;">
              <span class="trip-mini-label">Travellers / Mode</span>
              <span class="trip-mini-value" id="trip-travellers">‚Äî</span>
            </div>
            <div class="trip-mini-row" style="margin-top:4px; font-size:12px; color:var(--text-soft);">
              <span class="trip-mini-label">Notes</span>
              <span class="trip-mini-value" id="trip-notes">‚Äî</span>
            </div>
          </div>

          <!-- Only SOS + End Trip + Extend Trip -->
          <div class="btn-row">
            <button type="button" class="btn btn-danger" id="btn-sos">
              üÜò Trigger SOS
            </button>

            <button type="button" class="btn btn-soft" id="btn-end" onclick="endTrip()">
              ‚úÖ End Trip & Turn Off Monitoring
            </button>

            <button type="button" class="btn btn-ghost" id="btn-extend">
              üïí Extend Trip Time
            </button>
          </div>

          <p class="muted">
            During this screen, all other settings are locked for safety.<br />
            You control only three actions: <strong>SOS</strong>, <strong>End Trip</strong>, and
            <strong>Extend Trip</strong>.
          </p>
        </div>
      </div>
    </main>

    <div class="footer">
      <span>Trip live ¬∑ Geo-fence & SOS ready.</span>
      <span>Crossing boundary will raise alerts.</span>
    </div>
  </div>
      <script>
        function toggleTheme() {
          const html = document.documentElement;
          const current = html.getAttribute('data-theme');
          const next = current === 'light' ? 'dark' : 'light';
          html.setAttribute('data-theme', next);
          localStorage.setItem('theme', next);
          updateThemeUI(next);
        }

        function updateThemeUI(theme) {
          const icon = document.getElementById('theme-icon');
          const text = document.getElementById('theme-text');
          if (!icon || !text) return;
          if (theme === 'light') {
            icon.textContent = '‚òÄÔ∏è';
            text.textContent = 'Light';
          } else {
            icon.textContent = 'üåô';
            text.textContent = 'Dark';
          }
        }

        (function initTheme() {
          let saved = localStorage.getItem('theme');
          if (!saved) {
            saved = 'light'; // default to light theme
          }
          document.documentElement.setAttribute('data-theme', saved);
          updateThemeUI(saved);
        })();

        // Load active trip from localStorage and populate UI
        function loadActiveTrip() {
          try {
            const raw = localStorage.getItem('activeTrip');
            if (!raw) return null;
            return JSON.parse(raw);
          } catch (e) {
            console.warn('Failed parsing activeTrip', e);
            return null;
          }
        }

        function formatDateTime(isoOrString) {
          if (!isoOrString) return '';
          // If already combined like 'YYYY-MM-DD HH:MM', return as-is
          if (/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}/.test(isoOrString)) return isoOrString;
          const d = new Date(isoOrString);
          if (isNaN(d)) return isoOrString;
          return d.toLocaleString();
        }

        function renderTrip(trip) {
          const fromTo = document.getElementById('trip-from-to');
          const radius = document.getElementById('trip-radius');
          const status = document.getElementById('trip-status');
          const travellers = document.getElementById('trip-travellers');
          const notes = document.getElementById('trip-notes');

          if (!trip) {
            // No active trip ‚Äî show link back to setup
            const card = document.getElementById('trip-mini-card');
            card.innerHTML = '<div style="padding:12px; text-align:center; color:var(--text-soft);">No active trip found. <a href="/trip-setup">Create a trip</a></div>';
            document.getElementById('btn-end').disabled = true;
            return;
          }

          fromTo.textContent = `${trip.from} ‚Üí ${trip.to}`;
          radius.textContent = trip.radius ? `${trip.radius} km around route` : '‚Äî';
          status.innerHTML = `<span class="live-dot"></span> Geo-fence ON ¬∑ Monitoring`;
          travellers.textContent = `${trip.travellers || 1} ¬∑ ${trip.mode || '‚Äî'}`;
          notes.textContent = trip.notes ? trip.notes : '‚Äî';

          // Update header pill (if present)
          const headerStatus = document.querySelector('.trip-status-pill');
          if (headerStatus) headerStatus.innerHTML = '<span class="status-dot"></span> Trip active ¬∑ Geo-fence ON';
        }

        function endTrip() {
          if (!confirm('End this trip and turn off monitoring?')) return;
          try { localStorage.removeItem('activeTrip'); } catch (e) { console.warn(e); }
          // Redirect to home page using server route
          window.location.href = '/home';
        }

        // Wire up extend and sos buttons minimally
        document.addEventListener('DOMContentLoaded', function() {
          const trip = loadActiveTrip();
          renderTrip(trip);

          const btnSos = document.getElementById('btn-sos');
          if (btnSos) btnSos.addEventListener('click', function() { alert('SOS triggered (demo) ‚Äî contacting guardian & police'); });

          const btnExtend = document.getElementById('btn-extend');
          if (btnExtend) btnExtend.addEventListener('click', function() { alert('Extend trip (demo) ‚Äî open setup to modify end time'); });
        });
      </script>
    </body>
    </html>
